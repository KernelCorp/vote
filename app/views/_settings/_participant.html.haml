.row.settings
  .col.two_thirds
    = form_for who,
      url: participant_path, method: 'put',
      html: { class: 'form', data: { type: 'json' }, multipart: true },
      remote: true do |f|
      %h1= t 'participant.settings.main.header'
      %p= t 'participant.settings.main.description'

      %h3= t 'participant.settings.main.personal_info'
      .row
        .col= inp f, :secondname, :between => '*'
        .col 
          %h4
            = f.label :age
            *
          .select#settings_participant_age_select
            = f.text_field :age, class: 'select_current select_input', readonly: true, data: { listok: 'false' }
            .select_list
              - (15..99).each do |i|
                %div{ data: { select: i } }= i
      .row
        .col= inp f, :firstname, :between => '*'
        .col
          %h4
            = f.label :gender
            *
          .row{ style: 'line-height: 31px;' }
            = f.radio_button :gender, true
            = f.label :gender, t('participant.settings.main.gender.male'), value: true
            = f.radio_button :gender, false
            = f.label :gender, t('participant.settings.main.gender.female'), value: false, style: 'margin-left: 30px;'

      %h3= t 'participant.settings.main.contact_info'
      .row
        .col= inp f, :email, :between => '*'
        .col= inp f, :city, :between => '*'
      .row
        .col= inp f, :phone, :between => '*'
      .row.row_with_button
        .col.small_notation
          %span *
          = t 'organization.logup.field_required'
        .col= f.submit t('participant.settings.main.update')


    %h1= t 'participant.settings.table.title'
    %table#settings_participant_history_table
      %tr.row_with_names
        %td.date= t 'participant.settings.table.date'
        %td.amount= t 'participant.settings.table.amount'
        %td.status= t 'participant.settings.table.status'
        %td.method= t 'participant.settings.table.method'
      - who.payments.each do |payment|
        %tr
          %td.date= payment.created_at
          %td.amount= payment.amount
          %td.status= payment.is_approved
          %td.method Способ оплаты


  .col.one_third
    .settings_box#send_invitation_settings
      = form_tag invite_participant_path(current_participant), method: 'post',
        remote: true, format: :json,
        class: 'form', data: { sended: t('participant.settings.invite.sended') } do
        %h1= t 'participant.settings.invite.title'
        %p= t 'participant.settings.invite.description'
        
        .row= text_field_tag :email
        .row.row_with_button= submit_tag t('participant.settings.invite.send')
        .row
          .button.social_button.social_button_vk
          .button.social_button.social_button_f
          .button.social_button.social_button_t
          .button.social_button.social_button_g
          .button.social_button.social_button_od


    .settings_box#phones_settings
      = form_for Phone.new,
        url: participant_phones_path( current_participant ), method: 'post',
        remote: true, format: :json,
        html: { class: 'form', data: { added: t('participant.settings.phone.added'), error: t('participant.settings.phone.error') } } do |f|
        %h1= t 'participant.settings.phone.all'
        #settings_user_phones
          - current_participant.phones.each do |phone|
            .settings_uset_phone= phone.number

        %h1= t 'participant.settings.phone.add'
        .row
          %label{ for: 'phone32' }= t 'activerecord.attributes.organization.phone'
          %input{ id: 'phone32', name: 'no_name_phone32', type: 'text', placeholder: '+7(___)___-__-__' }
          = f.hidden_field :number, id: 'phone32_hidden_field'
        .row.row_with_button= submit_tag t('participant.settings.phone.save')

    .settings_box#password_settings
      = form_for who, 
        url: participant_path, method: 'put', 
        html: { class: 'form' },
        remote: true do |fu|
        %h1= t 'participant.settings.password_change.change'
        .row= inp fu, :current_password, :type => :password_field
        .row= inp fu, :password, :type => :password_field
        .row= inp fu, :password_confirmation, :type => :password_field
        .row.row_with_button= fu.submit t('participant.settings.password_change.save')

    :javascript
      (function(){
        var phones_settings = $("#phones_settings");

        function phone_regexp( element ){
          if( element.val().length ){
            var matches = element.val().match(/^\+7\((\d{3})\)(\d{3})-(\d{2})-(\d{2})$/);
            element.next().val( matches[1] + matches[2] + matches[3] + matches[4] );
          } else {
            element.next().val('');
          }
        }

        jQuery(function($){
          phones_settings.find('#phone32')
          .mask("+7(999)999-99-99", {
            completed: function(){
              phone_regexp( this );
            }
          })
          .on('change', function(){
            if( ! $(this).val().length ) $(this).next().val('');
          });
        });
        
      })();
